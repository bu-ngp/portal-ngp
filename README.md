Портал БУ "Нижневартовская городская поликлиника"
=================================================
![Портал БУ "НГП"](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/01.jpg)

**<p align="center">Содержание</p>**

  - [Краткое описание](#Краткое-описание)
  - [Основное меню](#Основное-меню)
    - [Настройки портала](#Настройки-портала)
      - [Настройки портала ОФОМС](#Настройки-портала-ОФОМС)
    - [Плитки на главной странице](#Плитки-на-главной-странице)
    - [Портал ОФОМС](#Портал-ОФОМС)
    - [Контакты IP телефонии](#Контакты-ip-телефонии)
    
## Краткое описание

Портал БУ "НГП" представляет из себя приложение расширение базовой системы портала организации [wk-portal](https://github.com/vovancho/wk-portal).

*Расширение в себя включает:*
  - Систему плиток на главной странице, с ссылками на доступные сайты, информационные системы для пользователей корпоративной сети;
  - Систему для работы с закрытой частью портала ОФОМС, используя REST API:
    - Проверка полисов пациентов;
    - Прикрепление пациентов к врачу;
    - Прикрепление пациентов списками (с использованием обработчика базовой системы).
  - Систему для работы с IP телефонией.

> Проект реализован с помощью PHP фреймворка Yii2

## Основное меню

![Основное меню](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/02.jpg)
*<p align="center">В основном меню добавлены три плитки: `Плитки на главной странице`, `Портал ОФОМС` и `Контакты IP телефонии`</p>*

### Настройки портала

![Настройки портала](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/03.jpg)
*<p align="center">В настройки портала добавлена одна плитка: `Настройки портала ОФОМС`</p>*

### Настройки портала ОФОМС

![Настройки портала ОФОМС](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/04.jpg)
*<p align="center">Форма настроек портала ОФОМС</p>*

Для активации проверки полисов и прикрепления пациентов на портале ОФОМС, необходимо указать следующие настройки:
  - Ссылка для проверки полисов на портале ОФОМС
  - Ссылка для прикрепления пациентов на портале ОФОМС
  - Логин портала ОФОМС
  - Пароль портала ОФОМС
  - Хост портала ОФОМС (для подмены заголовка запроса `Host`)
  
### Плитки на главной странице

![Плитки на главной странице](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/05.jpg)
*<p align="center">Грид с плитками на главной странице портала БУ "НГП"</p>*

Система плиток на главной странице имеет следующие возможности:
  - Плитки подгружаются по 6 штук при прокрутке вниз;
  - Чем чаще открывать плитки с определенными системами, тем выше они будут отображаться;
  - По плиткам можно осуществлять поиск. Поиск ищет по названиям, описанию, ключевым словам плиток;
  - В качестве иконки плитки можно загрузить\\обрезать картинку или выбрать иконку из набора `FontAwesome`.

![Плитки на главной странице, колонки](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/06.jpg)
*<p align="center">Настройки грида с плитками на главной странице портала БУ "НГП"</p>*

Грид содержит следующие колонки данных:
  - Превью
  - Название
  - Описание
  - Ссылка

и скрытые по умолчанию колонки:
  - Ключевые слова для поиска
  - Время создания записи
  - Время обновления записи
  - Автор создавший запись
  - Автор обновивший запись

![Плитки на главной странице, картинка](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/07.jpg)
*<p align="center">Загрузка и обрезка картинки при добавлении новой плитки</p>*

 - На сервер сохраняется только обрезанная картинка, а не вся целиком

![Плитки на главной странице, иконка](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/09.jpg)
*<p align="center">Выбор иконки при добавлении новой плитки</p>*

- Выбор иконок представлен библиотекой `FontAwesome`

### Портал ОФОМС

Портал ОФОМС - это сервис REST API в закрытой части сети `Vipnet` предоставляющий услуги:
  - Проверки полисов пациентов;
  - Прикрепления пациентов к участковым терапевтам или врачам общей практики ЛПУ.

![Портал ОФОМС](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/11.jpg)
*<p align="center">Грид с проверкой полисов на портале ОФОМС</p>*

Поиск пациентов осуществляется при помощи:
   - `КБП` (кода быстрого поиска), который состоит из ФИО и года рождения пациента;
   - `ЕНП` (единого номера полиса) пациента;
   - ФИО пациента полностью.
   
Пациенты могут иметь следующие статусы:
  - Прикреплен;
  - Не прикреплен;
  - Снят с учета.
  
> В колонке врач REST API сервис возвращает ИНН врача. Система сама ищет ФИО и должность врача в справочнике сотрудников по ИНН.
> В случае, если врач не найден в справочнике системы, возвращается ИНН врача. 

![Портал ОФОМС, колонки](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/13.jpg)
*<p align="center">Настройки грида с проверкой полисов на портале ОФОМС</p>*

Грид содержит следующие колонки данных:
  - Статус (Прикреплен, Не прикреплен, Снят с учета)
  - Фамилия
  - Имя
  - Отчество
  - Дата рождения
  - Единый номер полиса (ЕНП)
  - Номер бланка полиса
  - Врач
  - Территория страхования

и скрытые по умолчанию колонки:
  - Серия бланка полиса
  - Код врача из регионального регистра врачей
  - Код МО из регионального регистра МО (Амбулатория)
  - Код МО из регионального регистра МО (Стоматология)
  - Дата прикрепления в стоматологии
  - Пол
  - Код вида полиса
  - Наименование вида полиса
  - Дата выдачи полиса
  - Дата прекращения страхования в субъекте
  - Код СМО
  - Наименование СМО
  - Причина прекращения страхования

![Портал ОФОМС, прикрепление](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/12.jpg)
*<p align="center">Прикрепление пациента к врачу на портале ОФОМС</p>*

REST API сервис ОФОМС предоставляет возможность прикрепить пациента по ИНН врача. 
На форме прикрепления вместо поля для ввода ИНН врача имеется список с выбором врача терапевта участкового или врача общей практики.

> В случае, если врач не загружен на сервис ОФОМС, или в случае увольнения врача, система оповестит пользователя о ошибке прикрепления.

![Портал ОФОМС, прикрепление списком](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/14.jpg)
*<p align="center">Прикрепление пациентов файлом-списком на портале ОФОМС</p>*

Система имеет возможность пакетного прикрепления пациентов с помощью файлов `Excel`.
Для этого необходимо сформировать файл со следующими колонками:
  - ИНН Врача
  - Номер полиса пациента
  - Фамилия пациента
  - Имя пациента
  - Отчество пацииента (если есть)
  - Дата рождения пациента
  
или:
  - ИНН Врача
  - Номер полиса пациента
  - Фамилия Имя Отчество пациента
  - Дата рождения пациента
  
![Портал ОФОМС, обработчик](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/15.jpg)
*<p align="center">Обработчик задания прикрепления списка пациентов на портале ОФОМС, в гриде обработчиков портала БУ "НГП"</p>*

Пакетное прикрепление осуществляется с помощью [Обработчика системы](https://github.com/vovancho/wk-portal#%D0%9E%D0%B1%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%B8), так как может занимать длительное время.
По окончании процесса прикрепления в случае ошибок будет сформирован отчет в формате `Excel`, который будет доступен для скачивания.

### Контакты IP телефонии

![Контакты IP телефонии](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/16.jpg)
*<p align="center">Грид с контактами для IP телефонии</p>*

Контакты для IP телефонии представляют из себя справочник с наименованием контакта, телефонами и группой, за которой будет закреплен контакт.

В результате справочник будет доступен по следующим Url в виде `xml` ответа для IP телефонии:

Ссылка | Описание
--- | ---
http://ngp.local/ip-contact/menu | Список всех групп контактов
http://ngp.local/ip-contact/menu/{contact-group-id} | Список контактов в группе с ИД {contact-group-id}

![Контакты IP телефонии, редактирование](https://github.com/vovancho/wk-portal-ngp/blob/master/project/images/17.jpg)
*<p align="center">Форма редактирования контакта для IP телефонии</p>*